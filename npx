#!/bin/bash
set -e  # Exit on error

echo "Début script"

# Store the original directory
original_dir=$(pwd)

# Dynamically find the NPX path
NPX_CMD="$HOME/.nvm/versions/node/$(node -v)/bin/npx"

# Check if NPX is found
if [[ -z "$NPX_CMD" ]]; then
    echo "Erreur: npx introuvable. Assurez-vous que Node.js est installé." >&2
    exit 1
fi

echo "Commande exécutée: $NPX_CMD $@"

# Navigate to the test directory
if cd playwright-sample-project/n1/n2; then
    ls  # List contents to verify navigation
else
    echo "Erreur: Impossible de changer de répertoire." >&2
    exit 1
fi

# Execute the npx command with the provided arguments
$NPX_CMD "$@"

echo "Copier le dossier de rapports"

# Move the Playwright report back to the original directory if it exists
if [[ -d "./playwright-report" ]]; then
    mv ./playwright-report/ "$original_dir"
fi

# Return to the original directory
cd "$original_dir"

echo "Fin script"
